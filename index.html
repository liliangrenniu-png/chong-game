<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç»˜æ¢¦çŒ«çµï¼šè§†è§‰é­”æ³•ç¯‡</title>
    <style>
        :root { --ui-font: "Georgia", cursive, serif; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #0c0c1d; font-family: var(--ui-font); user-select: none; }

        #stage { width: 100%; height: 100%; position: relative; overflow: hidden; }
        
        /* --- é­”æ³•æ°›å›´å±‚ (å…¨å±€) --- */
        /* å…¨å±€å…‰ç…§ç»Ÿä¸€å±‚ï¼šç»™æ•´ä¸ªç”»é¢è’™ä¸Šä¸€å±‚æ¢¦å¹»çš„è´¨æ„Ÿ */
        .global-overlay {
            position: absolute; width: 100%; height: 100%; pointer-events: none; z-index: 30;
            background: radial-gradient(circle at center, transparent 20%, rgba(12, 12, 29, 0.6) 100%); /* æš—è§’ */
            mix-blend-mode: multiply;
        }
        /* é­”æ³•å¾®ç²’ */
        .magic-dust {
            position: absolute; width: 100%; height: 100%; pointer-events: none; z-index: 25;
            background-image: url('https://cdn.pixabay.com/photo/2016/11/23/13/39/christmas-1853231_1280.jpg'); /* æ•£ç„¦å…‰ç‚¹ç´ æ */
            background-size: cover; opacity: 0.2; mix-blend-mode: screen;
            animation: drift 40s linear infinite alternate;
        }

        /* --- åœºæ™¯å®¹å™¨ --- */
        .scene-container { 
            width: 300%; height: 100%; display: flex; position: absolute; top: 0; left: 0; 
            transition: transform 1.2s cubic-bezier(0.215, 0.610, 0.355, 1); /* æ›´å¯Œæœ‰å¼¹æ€§çš„åˆ‡æ¢æ›²çº¿ */
        }
        .scene { position: relative; width: 33.333%; height: 100%; overflow: hidden; }

        /* é€šç”¨å›¾å±‚æ ·å¼ */
        .layer { position: absolute; background-size: cover; background-position: center; transition: transform 1.2s ease-out; }
        /* èƒŒæ™¯å±‚ (ç§»åŠ¨æœ€æ…¢) */
        .bg-layer { width: 110%; height: 110%; left: -5%; top: -5%; z-index: 1; filter: blur(1px); }
        /* å‰æ™¯å±‚ (ç§»åŠ¨æœ€å¿«ï¼Œç”¨äºåˆ¶é€ æ™¯æ·±é®æŒ¡) */
        .fg-layer { width: 120%; height: 120%; left: -10%; top: -5%; z-index: 60; pointer-events: none; }

        /* åœºæ™¯1ï¼šæš–å…‰ä¹¦æˆ¿ */
        .s0 .bg-layer { background-image: url('https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=2070&q=80'); filter: sepia(0.5) brightness(0.8) contrast(1.1); }
        .s0 .fg-layer { background-image: url('https://png.pngtree.com/png-clipart/20230916/ourmid/pngtree-bookshelf-library-frame-png-image_10074963.png'); opacity: 0.7; filter: sepia(0.8) brightness(0.5) blur(3px); } /* å‰æ™¯ä¹¦æ¶æ¡†æ¶ */
        
        /* åœºæ™¯2ï¼šå†·å¯‚æ£®æ— */
        .s1 .bg-layer { background-image: url('https://images.unsplash.com/photo-1448375240586-882707db888b?auto=format&fit=crop&w=2070&q=80'); filter: brightness(0.6) hue-rotate(190deg) contrast(1.2); }
        .s1 .fg-layer { background-image: url('https://static.vecteezy.com/system/resources/previews/024/583/799/original/dark-forest-frame-with-tree-branches-and-leaves-overlay-png.png'); opacity: 0.8; filter: brightness(0.3) blur(2px); } /* å‰æ™¯æ ‘æ */

        /* åœºæ™¯3ï¼šæ¢¦å¹»äº‘ç«¯ */
        .s2 .bg-layer { background-image: url('https://images.unsplash.com/photo-1499346030926-9a72daac6c63?auto=format&fit=crop&w=2070&q=80'); filter: brightness(1.1) hue-rotate(-20deg); }
        .s2 .fg-layer { background-image: url('https://png.pngtree.com/png-clipart/20230428/ourmid/pngtree-clouds-fluffy-white-cartoon-frame-border-png-image_6741259.png'); opacity: 0.5; filter: brightness(1.2) blur(5px); } /* å‰æ™¯äº‘æœµ */

        /* --- ä¸»è§’ï¼šæ‹¥æœ‰é€è§†æ„Ÿçš„å°é»‘çŒ« --- */
        .cat-container {
            position: absolute;
            z-index: 50; /* åœ¨èƒŒæ™¯ä¹‹ä¸Šï¼Œå‰æ™¯ä¹‹ä¸‹ */
            /* æ ¸å¿ƒï¼šä½¿ç”¨ CSS å˜é‡æ§åˆ¶é€è§†ç¼©æ”¾å’Œå…‰ç…§ */
            transform: translate(var(--x), var(--y)) scale(var(--scale));
            filter: var(--scene-light-filter); /* æ¥æ”¶ç¯å¢ƒå…‰ */
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), filter 1.2s ease-out, opacity 0.3s;
            will-change: transform; /* æ€§èƒ½ä¼˜åŒ– */
        }
        
        .cat-sprite {
            width: 180px; height: 180px; cursor: pointer;
            /* ä½¿ç”¨ä¸€ä¸ªæ›´é«˜è´¨é‡ã€å¸¦æœ‰æ¯›å‘è´¨æ„Ÿçš„æ’ç”»ç´ æ */
            background-image: url('https://i.pinimg.com/originals/81/6d/a5/816da53317b6a90861ba18250589c452.png');
            background-size: contain; background-repeat: no-repeat; background-position: bottom center;
            /* åŠ¨æ€é˜´å½±ï¼šéšç€çŒ«å’ªä½ç½®å˜åŒ–ï¼Œé˜´å½±ä¹Ÿä¼šå˜åŒ–ï¼Œå¢å¼ºæ¥åœ°æ„Ÿ */
            filter: drop-shadow(0px 10px 15px rgba(0,0,0,0.5)); 
            animation: cat-idle 4s ease-in-out infinite;
        }
        .cat-sprite:hover { filter: drop-shadow(0px 15px 25px rgba(0,0,0,0.7)) brightness(1.1); }

        @keyframes drift { 0% { background-position: 0% 0%; } 100% { background-position: 20% 10%; } }
        @keyframes cat-idle { 0%, 100% { transform: scaleY(1); } 50% { transform: scaleY(1.04) translateY(-5px); } }

        /* UI ä¿æŒä¸å˜ï¼Œçœç•¥æ ·å¼ä»¥èšç„¦æ ¸å¿ƒé€»è¾‘ */
        #hud, #controls { position: absolute; z-index: 100; pointer-events: none; }
        .ui-btn { pointer-events: auto; background: rgba(0,0,0,0.5); color: white; border: 2px solid rgba(255,255,255,0.5); padding: 10px 20px; border-radius: 20px; cursor: pointer; backdrop-filter: blur(5px); font-weight: bold; }
        .fx-floater { position: absolute; z-index: 200; font-size: 40px; animation: float-up 1.5s forwards; text-shadow: 0 0 10px white; }
        @keyframes float-up { to { transform: translateY(-100px) scale(1.5); opacity: 0; } }
    </style>
</head>
<body>

<div id="stage">
    <div class="global-overlay"></div>
    <div class="magic-dust"></div>

    <div class="scene-container" id="world">
        <div class="scene s0"><div class="layer bg-layer"></div><div class="layer fg-layer"></div></div>
        <div class="scene s1"><div class="layer bg-layer"></div><div class="layer fg-layer"></div></div>
        <div class="scene s2"><div class="layer bg-layer"></div><div class="layer fg-layer"></div></div>
    </div>

    <div id="hud" style="top:20px; left:20px;"><div class="ui-btn">ğŸŒ™ é­”åŠ›: <span id="coin-txt">100</span></div></div>
    <div id="controls" style="bottom:30px; width:100%; display:flex; justify-content:center; gap:20px;">
        <div class="ui-btn" onclick="switchScene(-1)">â—€</div>
        <div class="ui-btn" style="font-size:30px; background: linear-gradient(45deg, #ff9a9e, #fad0c4);" onclick="summonCat()">âœ¨</div>
        <div class="ui-btn" onclick="switchScene(1)">â–¶</div>
    </div>
</div>

<script>
    let coins = 100;
    let cats = [];
    let currentSceneIdx = 0;

    // å®šä¹‰æ¯ä¸ªåœºæ™¯çš„ç¯å¢ƒå…‰æ»¤é•œ
    const sceneLightFilters = [
        'sepia(0.5) brightness(1.1) contrast(0.9)', // æš–ä¹¦æˆ¿ï¼šåé»„ï¼ŒæŸ”å’Œ
        'brightness(0.6) hue-rotate(190deg) saturate(0.8)', // å†·æ£®æ—ï¼šæš—æ·¡ï¼Œåè“å†·è‰²
        'brightness(1.2) saturate(1.2)' // äº®äº‘ç«¯ï¼šæ˜äº®ï¼Œé«˜é¥±å’Œ
    ];

    class VisualMagicCat {
        constructor() {
            this.sceneLocation = currentSceneIdx;
            // åˆå§‹ä½ç½®
            this.posX = window.innerWidth * 0.2 + Math.random() * (window.innerWidth * 0.6);
            this.posY = window.innerHeight * 0.4 + Math.random() * (window.innerHeight * 0.4); // é™åˆ¶åœ¨åœ°æ¿åŒºåŸŸ
            this.createDOM();
            this.startAI();
        }

        createDOM() {
            // å®¹å™¨ç”¨äºå¤„ç†ä½ç½®å’Œé€è§†
            this.container = document.createElement('div');
            this.container.className = 'cat-container';
            // ç²¾çµç”¨äºå¤„ç†åŠ¨ç”»å’Œäº¤äº’
            this.sprite = document.createElement('div');
            this.sprite.className = 'cat-sprite';
            
            this.container.appendChild(this.sprite);
            
            this.sprite.onclick = (e) => { e.stopPropagation(); this.interact(); };
            document.getElementById('stage').appendChild(this.container);

            this.updateVisuals();
        }

        /**
         * æ ¸å¿ƒé­”æ³•å‡½æ•°ï¼šæ ¹æ®çŒ«å’ªçš„ä½ç½®å’Œæ‰€å¤„åœºæ™¯ï¼ŒåŠ¨æ€æ›´æ–°å®ƒçš„è§†è§‰è¡¨ç°
         */
        updateVisuals() {
            // 1. è®¡ç®—é€è§†ç¼©æ”¾ (Perspective Calculation)
            // å±å¹•è¶Šé ä¸‹ (posYè¶Šå¤§)ï¼Œscaleè¶Šå¤§ã€‚èŒƒå›´å¤§çº¦åœ¨ 0.7 (è¿œ) åˆ° 1.1 (è¿‘) ä¹‹é—´
            const perspectiveScale = 0.7 + (this.posY / window.innerHeight) * 0.4;
            
            // 2. åº”ç”¨ä½ç½®å’Œç¼©æ”¾
            // ä½¿ç”¨ CSS å˜é‡å¯ä»¥è·å¾—æ›´æµç•…çš„æ€§èƒ½
            this.container.style.setProperty('--x', (this.posX - 90) + 'px');
            this.container.style.setProperty('--y', (this.posY - 160) + 'px'); // é”šç‚¹å®šåœ¨è„šåº•
            this.container.style.setProperty('--scale', perspectiveScale);

            // 3. åº”ç”¨ç¯å¢ƒå…‰èåˆ (Environmental Blending)
            // åªæœ‰å½“çŒ«å’ªåœ¨å½“å‰è§‚çœ‹çš„åœºæ™¯æ—¶ï¼Œæ‰åº”ç”¨å½“å‰åœºæ™¯çš„å…‰ç…§
            if (this.sceneLocation === currentSceneIdx) {
                 this.container.style.setProperty('--scene-light-filter', sceneLightFilters[currentSceneIdx]);
                 this.container.style.opacity = 1;
                 this.container.style.pointerEvents = 'auto';
            } else {
                 this.container.style.opacity = 0;
                 this.container.style.pointerEvents = 'none';
            }
        }

        interact() {
            coins += 10; updateUI();
            this.sprite.style.animation = 'none';
            this.container.style.transition = 'transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)'; // ä¸´æ—¶åŠ å¿«åŠ¨ç”»
            // äº¤äº’æ—¶ç¨å¾®æ”¾å¤§å¹¶è·³èµ·ï¼ŒåŒæ—¶å åŠ é‡‘è‰²é«˜å…‰
            this.container.style.transform = `translate(var(--x), calc(var(--y) - 30px)) scale(calc(var(--scale) * 1.2))`;
            this.container.style.filter = `var(--scene-light-filter) drop-shadow(0 0 30px gold) brightness(1.3)`;
            
            spawnFX('ğŸ’–', this.posX, this.posY - 100);

            setTimeout(() => {
                this.sprite.style.animation = 'cat-idle 4s ease-in-out infinite';
                this.container.style.transition = ''; // æ¢å¤é»˜è®¤è¿‡æ¸¡
                this.updateVisuals(); // æ¢å¤æ­£å¸¸è§†è§‰
            }, 500);
        }

        startAI() {
            setInterval(() => {
                if (Math.random() > 0.6 && this.sceneLocation === currentSceneIdx) {
                    this.wander();
                }
            }, 3000 + Math.random() * 2000);
        }

        wander() {
            this.posX += (Math.random() - 0.5) * 200;
            // åœ¨Yè½´ç§»åŠ¨æ—¶ï¼Œé™åˆ¶èŒƒå›´ï¼Œç¡®ä¿å®ƒä¸ä¼šèµ°åˆ°â€œå¤©ä¸Šâ€å»
            this.posY += (Math.random() - 0.5) * 120;
            this.posX = Math.max(100, Math.min(window.innerWidth - 100, this.posX));
            this.posY = Math.max(window.innerHeight * 0.35, Math.min(window.innerHeight - 100, this.posY));
            
            // ç§»åŠ¨åï¼Œç«‹å³æ›´æ–°é€è§†å’Œè§†è§‰
            this.updateVisuals();
        }
    }

    function updateUI() { document.getElementById('coin-txt').innerText = coins; }

    function switchScene(dir) {
        currentSceneIdx = (currentSceneIdx + dir + 3) % 3;
        document.getElementById('world').style.transform = `translateX(-${currentSceneIdx * 33.333}%)`;
        
        // ä¸“å®¶çº§è§†å·®æ»šåŠ¨ (Parallax Scrolling)
        // èƒŒæ™¯å±‚æ…¢é€Ÿåå‘ç§»åŠ¨
        document.querySelectorAll('.bg-layer').forEach((bg, idx) => {
            const relativePos = idx - currentSceneIdx;
            bg.style.transform = `translateX(${relativePos * 15}%) scale(1.1)`;
        });
        // å‰æ™¯å±‚å¿«é€Ÿåå‘ç§»åŠ¨ (åˆ¶é€ å¼ºçƒˆçš„é®æŒ¡æ„Ÿ)
        document.querySelectorAll('.fg-layer').forEach((fg, idx) => {
            const relativePos = idx - currentSceneIdx;
            fg.style.transform = `translateX(${relativePos * 35}%) scale(1.2)`;
        });

        // æ›´æ–°æ‰€æœ‰çŒ«å’ªçš„è§†è§‰çŠ¶æ€ï¼ˆä¸»è¦æ˜¯å…‰ç…§å’Œå¯è§æ€§ï¼‰
        cats.forEach(cat => cat.updateVisuals());
    }

    function summonCat() {
        if(coins >= 50) {
            coins -= 50; updateUI();
            cats.push(new VisualMagicCat());
            spawnFX('âœ¨', window.innerWidth/2, window.innerHeight/2);
        }
    }

    function spawnFX(emoji, x, y) {
        const fx = document.createElement('div'); fx.className = 'fx-floater'; fx.innerText = emoji;
        fx.style.left = x + 'px'; fx.style.top = y + 'px';
        document.getElementById('stage').appendChild(fx);
        setTimeout(() => fx.remove(), 1500);
    }

    cats.push(new VisualMagicCat());
    updateUI();
    // åˆå§‹åŒ–ä¸€æ¬¡è§†å·®ä½ç½®
    switchScene(0);
</script>
</body>
</html>
