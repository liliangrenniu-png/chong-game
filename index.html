<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ¢¦å¹»å–µçµï¼šé­”å…½è§‰é†’</title>
    <style>
        :root { --p-gold: #ffd700; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: "Segoe UI", sans-serif; }

        /* --- æ·±åº¦åœºæ™¯è®¾è®¡ --- */
        #viewport { width: 100vw; height: 100vh; position: relative; overflow: hidden; }
        .scene { 
            width: 100%; height: 100%; position: absolute; top: 0; left: 0; 
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; justify-content: center; align-items: center;
        }

        /* å¨æˆ¿ï¼šç“·ç –çº¹ç†ä¸ç¶å° */
        .kitchen { 
            background: #ffbe76; 
            background-image: radial-gradient(rgba(0,0,0,0.05) 2px, transparent 2px);
            background-size: 30px 30px;
        }
        .stove-bg { position: absolute; bottom: 0; width: 100%; height: 120px; background: #dfe6e9; border-top: 5px solid #636e72; }

        /* å§å®¤ï¼šåœ°æ¯¯ä¸æ¸©é¦¨æ„Ÿ */
        .bedroom { background: #a29bfe; }
        .carpet { position: absolute; width: 80%; height: 200px; background: rgba(0,0,0,0.1); border-radius: 50%; bottom: 50px; }

        /* æµ´å®¤ï¼šæ°´é›¾ä¸ç“·ç – */
        .bathroom { background: #81ecec; }
        .mist { position: absolute; width: 100%; height: 100%; background: rgba(255,255,255,0.2); filter: blur(20px); }

        /* --- å¤šæ ·åŒ–é­”å…½æ„é€  --- */
        .beast-container {
            position: absolute; width: 180px; height: 180px;
            cursor: pointer; z-index: 50; transition: filter 0.5s;
        }

        .beast-body-wrap { position: relative; width: 100%; height: 100%; animation: breathe 3s infinite ease-in-out; }

        /* æ ¸å¿ƒè‚¢ä½“ï¼šå¸¦é˜´å½±çš„ç«‹ä½“æ„Ÿ */
        .b-torso { 
            position: absolute; width: 100px; height: 65px; 
            border-radius: 50px 60px 40px 40px; bottom: 40px; left: 40px;
            box-shadow: inset -10px -10px 20px rgba(0,0,0,0.2);
        }
        .b-head { 
            position: absolute; width: 85px; height: 80px; 
            border-radius: 50%; top: 10px; left: 45px; z-index: 10;
            box-shadow: inset 5px 5px 15px rgba(255,255,255,0.4), 0 5px 15px rgba(0,0,0,0.2);
        }

        /* å„ç§è§’å’Œç¿…è†€ */
        .b-horn { position: absolute; font-size: 30px; top: -15px; z-index: 5; }
        .horn-l { left: 15px; transform: rotate(-20deg); }
        .horn-r { right: 15px; transform: rotate(20deg) scaleX(-1); }

        .b-wing { position: absolute; font-size: 60px; top: -10px; opacity: 0.8; animation: flap 0.5s infinite alternate; }
        .wing-l { left: 0; transform: scaleX(-1); }
        .wing-r { right: 0; }

        .b-tail { position: absolute; font-size: 40px; right: 0; bottom: 50px; transform-origin: left; animation: wag 1s infinite; }

        /* --- çŠ¶æ€ç‰¹æ•ˆ --- */
        .is-sick { filter: grayscale(0.8) brightness(0.7); animation: shiver 0.2s infinite; }
        @keyframes shiver { 0% { transform: translate(1px, 1px); } 100% { transform: translate(-1px, -1px); } }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes flap { from { transform: translateY(0) rotate(0); } to { transform: translateY(-15px) rotate(-20deg); } }

        /* --- äº’åŠ¨ UI --- */
        #hud { position: absolute; top: 20px; left: 20px; z-index: 1000; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .stat { background: rgba(0,0,0,0.3); padding: 10px 20px; border-radius: 20px; margin-bottom: 5px; }

        .dock { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; z-index: 1000; }
        .tool { 
            width: 60px; height: 60px; background: white; border-radius: 15px; 
            display: flex; align-items: center; justify-content: center; font-size: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); cursor: pointer; transition: 0.3s;
        }
        .tool:hover { transform: translateY(-10px) rotate(10deg); background: var(--p-gold); }
    </style>
</head>
<body>

<div id="viewport">
    <div id="s0" class="scene kitchen" style="transform: translateX(0%)">
        <div class="stove-bg"></div>
    </div>
    <div id="s1" class="scene bedroom" style="transform: translateX(100%)">
        <div class="carpet"></div>
    </div>
    <div id="s2" class="scene bathroom" style="transform: translateX(200%)">
        <div class="mist"></div>
    </div>

    <div id="hud">
        <div class="stat">âœ¨ æ˜Ÿæ„¿é‡‘å¸: <span id="coin-txt">30</span></div>
        <div class="stat">ğŸ¥ å¥åº·å–µçµ: <span id="health-txt">1</span></div>
    </div>

    <div class="dock">
        <div class="tool" onclick="prevScene()">â¬…ï¸</div>
        <div class="tool" onclick="spawnFood()">ğŸŸ</div>
        <div class="tool" onclick="healAll()">ğŸ§ª</div>
        <div class="tool" onclick="hatchBeast()">ğŸ¥š</div>
        <div class="tool" onclick="nextScene()">â¡ï¸</div>
    </div>
</div>

<script>
    let coins = 30;
    let beasts = [];
    let currentIdx = 0;
    const hornAssets = ['ğŸ‚', 'ğŸ¦„', 'ğŸ‹', 'ğŸ”¥'];
    const wingAssets = ['ğŸ¦‹', 'ğŸ¦…', 'ğŸ¦‡', 'ğŸƒ'];
    const tailAssets = ['ğŸ¦Š', 'ğŸ', 'ğŸ”¥', 'â˜ï¸'];

    class MagicalBeast {
        constructor() {
            this.id = Date.now();
            this.isSick = false;
            this.x = Math.random() * (window.innerWidth - 200);
            this.y = Math.random() * (window.innerHeight - 250) + 100;
            this.hue = Math.random() * 360;
            this.dna = {
                horn: hornAssets[Math.floor(Math.random()*hornAssets.length)],
                wing: wingAssets[Math.floor(Math.random()*wingAssets.length)],
                tail: tailAssets[Math.floor(Math.random()*tailAssets.length)]
            };
            this.render();
            this.brain();
        }

        render() {
            this.el = document.createElement('div');
            this.el.className = 'beast-container';
            this.el.innerHTML = `
                <div class="beast-body-wrap">
                    <div class="b-wing wing-l">${this.dna.wing}</div>
                    <div class="b-wing wing-r">${this.dna.wing}</div>
                    <div class="b-tail">${this.dna.tail}</div>
                    <div class="b-torso" style="background: hsl(${this.hue}, 80%, 70%)"></div>
                    <div class="b-head" style="background: hsl(${this.hue}, 80%, 75%)">
                        <div class="b-horn horn-l">${this.dna.horn}</div>
                        <div class="b-horn horn-r">${this.dna.horn}</div>
                        <div style="position:absolute; top:35px; left:20px; font-size:12px;">âš«</div>
                        <div style="position:absolute; top:35px; right:20px; font-size:12px;">âš«</div>
                    </div>
                </div>
            `;
            this.el.onclick = () => this.interact();
            document.getElementById('viewport').appendChild(this.el);
            this.updatePos();
        }

        updatePos() {
            this.el.style.left = this.x + 'px';
            this.el.style.top = this.y + 'px';
        }

        interact() {
            if(this.isSick) {
                alert("è¿™åªå–µçµç—…äº†ï¼Œå¿«ç”¨è¯æ°´ï¼");
                return;
            }
            coins += 2;
            this.el.style.transform = 'scale(1.2) rotate(10deg)';
            setTimeout(() => this.el.style.transform = '', 300);
            updateUI();
        }

        brain() {
            setInterval(() => {
                if (!this.isSick) {
                    this.x += (Math.random() - 0.5) * 200;
                    this.y += (Math.random() - 0.5) * 100;
                    this.x = Math.max(50, Math.min(window.innerWidth - 200, this.x));
                    this.y = Math.max(150, Math.min(window.innerHeight - 200, this.y));
                    this.updatePos();
                }
                // 5% æ¦‚ç‡ç”Ÿç—…
                if(Math.random() > 0.95 && !this.isSick) {
                    this.isSick = true;
                    this.el.classList.add('is-sick');
                }
            }, 3000);
        }

        heal() {
            this.isSick = false;
            this.el.classList.remove('is-sick');
        }
    }

    // åˆå§‹åŒ–ä¸€åª
    beasts.push(new MagicalBeast());

    function updateUI() {
        document.getElementById('coin-txt').innerText = coins;
        document.getElementById('health-txt').innerText = beasts.filter(b => !b.isSick).length;
    }

    function nextScene() {
        if(currentIdx < 2) {
            currentIdx++;
            slide();
        }
    }

    function prevScene() {
        if(currentIdx > 0) {
            currentIdx--;
            slide();
        }
    }

    function slide() {
        for(let i=0; i<3; i++) {
            document.getElementById('s'+i).style.transform = `translateX(${(i - currentIdx)*100}%)`;
        }
    }

    function hatchBeast() {
        if(coins >= 12) {
            coins -= 12;
            beasts.push(new MagicalBeast());
            updateUI();
        }
    }

    function healAll() {
        if(coins >= 5) {
            coins -= 5;
            beasts.forEach(b => b.heal());
            updateUI();
            alert("å¥‡è¿¹è¯æ°´ï¼æ‰€æœ‰å–µçµæ¢å¤äº†ï¼");
        }
    }

    function spawnFood() {
        const fish = document.createElement('div');
        fish.innerText = 'ğŸŸ';
        fish.style.position = 'absolute';
        fish.style.fontSize = '40px';
        const tx = Math.random() * 800;
        const ty = Math.random() * 500 + 100;
        fish.style.left = tx + 'px'; fish.style.top = ty + 'px';
        document.getElementById('viewport').appendChild(fish);

        // å¸å¼•æœ€è¿‘çš„çŒ«
        if(beasts.length > 0) {
            beasts[0].x = tx; beasts[0].y = ty;
            beasts[0].updatePos();
            setTimeout(() => { fish.remove(); coins += 5; updateUI(); }, 1000);
        }
    }
</script>
</body>
</html>
